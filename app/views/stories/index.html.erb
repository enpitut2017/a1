<p id="notice"><%= notice %></p>

<h1>体験談一覧</h1>

<!--検索機能-->
<form name="search_form" method="get">

  <strong>学類</strong>
  <% @departments = Department.all %>
  <select name="department_select">
    <option value="0">指定しない</option>
    <% @departments.each do |dep| %>
      <% if params["department_select"].to_i == dep.id %>
        <option value="<%= dep.id %>" selected="selected"><%= dep.name %></option>
      <% else %>
        <option value="<%= dep.id %>"><%= dep.name %></option>
      <% end %>
    <% end %>
  </select>
　
  <strong>カテゴリ</strong>
  <% @categories = Category.all %>
  <select name="category_select">
    <option value="0">指定しない</option>
    <% @categories.each do |cat| %>
      <% if params["category_select"].to_i == cat.id %>
        <option value="<%= cat.id %>" selected="selected"><%= cat.name %></option>
      <% else %>
        <option value="<%= cat.id %>"><%= cat.name %></option>
      <% end %>
    <% end %>
  </select>
　
  <input type="submit" value="検索">
</form>
<!--検索機能ここまで-->


<% if params["department_select"].to_i > 0 %>
  <% @stories = @stories.where(department_id: params["department_select"]) %>
<% end %>
<% if params["category_select"].to_i > 0 %>
  <% @stories = @stories.where(category_id: params["category_select"]) %>
<% end %>


<% if @stories.length == 0 %>

  <table class="table table-bordered">
    <tr>
      <td>現在、該当する投稿はありません。</td>
    </tr>
  </table>

<% else %>

  <% @stories.each do |story| %>
    <% cat = story.category_id %>
    <table class="table table-bordered">
      <tr class="bg-primary">
        <th colspan="3"><%= story.title %><div align="right"><%= story.category.name %></div></th>
      </tr>
      <tr>
        <td><%= story.department.name %></td>
        <td><%= story.company %></td>
        <td>大学<%= story.year %>年　<%= story.month %>月</td>
      </tr>

      <tr>

        <td colspan="3"><%= truncate(simple_format(story.content), length: 160, escape: false) %><br><%= link_to 'もっと見る', story_path(story, department_select: params["department_select"], category_select: params["category_select"]), :class => 'btn btn-success pull-right' %></td>
        <!--<td><%= link_to 'Edit', edit_story_path(story) %></td>
        <td><%= link_to 'Destroy', story, method: :delete, data: { confirm: 'Are you sure?' } %></td>-->
      </tr>
      <tr>
        <td colspan="3" class="border-only-top created-at">投稿日：<%= story.created_at.to_s.split(" ")[0] %></td>
      </tr>
    </table>
  <% end %>
<% end %>

<%= link_to '新しい体験談を投稿する', new_story_path, :class => 'btn btn-primary'%><br><br>
  <p id="pageTop">
    <%= link_to 'Page top', "#", :class => 'btn btn-default'%>
  </p>
